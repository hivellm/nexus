import{d as M,u as U,v as z,r as i,c as B,f as T,a as n,b as e,e as u,z as y,D as O,t as a,A as V,i as b,F as w,l as _,n as q,j as G,C as N,m as K,o}from"./index-CtlbldqF.js";const H={class:"h-full flex flex-col p-6"},Q={class:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6"},W={class:"lg:col-span-2 card p-4"},X={class:"space-y-3"},Y={class:"flex items-center gap-2"},Z={class:"text-xs text-text-muted"},ee={key:2,class:"space-y-2"},te={key:0,class:"text-sm text-text-muted"},se={key:3,class:"text-xs text-text-muted"},le={key:4,class:"text-xs text-error"},ne={class:"card p-4"},oe={class:"space-y-4"},ae=["value"],re=["disabled"],ie={class:"flex-1 overflow-hidden"},de={key:0,class:"mb-4 p-4 bg-error/10 border border-error/20 rounded-lg"},ue={class:"mt-1 text-sm text-text-secondary"},ce={key:1,class:"card h-full flex flex-col"},me={class:"p-4 border-b border-border flex items-center justify-between"},ve={class:"flex items-center gap-4"},fe={class:"text-sm text-text-muted"},xe={class:"flex-1 overflow-auto p-4"},pe={class:"table"},be={class:"text-center font-mono"},ge={class:"font-mono text-sm"},ye={class:"flex items-center gap-2"},he={class:"w-20 h-2 bg-bg-tertiary rounded-full overflow-hidden"},Se={class:"text-sm font-mono"},ke=["onClick"],we=["onClick"],_e={key:2,class:"h-full flex items-center justify-center"},Ne={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},Fe={class:"bg-bg-secondary rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[80vh] overflow-auto"},Ee={class:"flex items-center justify-between mb-4"},je={class:"space-y-4"},Ve={class:"ml-2 font-mono"},Ce={class:"ml-2"},Le={class:"p-4 bg-bg-tertiary rounded-lg font-mono text-sm overflow-auto max-h-64"},Oe={class:"flex justify-end mt-6"},Pe=M({__name:"VectorSearchView",setup(Je){const J=K(),C=U(),g=z(),d=i("text"),h=i(""),f=i(""),F=i(""),E=i(10),j=i(""),L=i([]),x=i(!1),m=i(null),c=i([]),v=i(null),S=i(null),p=B(()=>{S.value=null;try{if(d.value==="text"&&h.value.trim())return h.value.split(",").map(t=>{const s=parseFloat(t.trim());if(isNaN(s))throw new Error(`Invalid number: ${t}`);return s});if(d.value==="json"&&f.value.trim()){const l=JSON.parse(f.value);if(!Array.isArray(l))throw new Error("Must be a JSON array");if(!l.every(t=>typeof t=="number"))throw new Error("All elements must be numbers");return l}return[]}catch(l){return S.value=l.message,[]}});async function A(){const l=C.activeClient;if(l)try{const t=await l.getLabels();t.success&&t.data&&(L.value=t.data.map(s=>s.name||s.label||String(s)))}catch(t){console.error("Failed to load labels:",t)}}async function P(){try{const l=await N.openFile({title:"Load Embedding File",filters:[{name:"JSON Files",extensions:["json"]},{name:"All Files",extensions:["*"]}]});if(l){const t=await N.readFile(l),s=JSON.parse(t);if(Array.isArray(s))f.value=JSON.stringify(s),d.value="json";else if(s.embedding&&Array.isArray(s.embedding))f.value=JSON.stringify(s.embedding),d.value="json";else throw new Error('File must contain a JSON array or object with "embedding" field');F.value=l.split(/[\\/]/).pop()||l,g.success("File loaded",`Loaded ${p.value.length} dimensions`)}}catch(l){g.error("Load failed",l.message)}}async function $(){const l=C.activeClient;if(!l){m.value="No server connected";return}if(p.value.length===0){m.value="Please enter a valid embedding vector";return}x.value=!0,m.value=null,c.value=[];try{const t=await l.knnSearch(p.value,E.value,j.value||void 0);if(t.success&&t.data){const s=t.data.rows||t.data||[];c.value=s.map(r=>({id:r.id||r._nexus_id||r.nodeId,labels:r.labels||r._nexus_labels||[],similarity:r.similarity||r.score||r.distance||0,properties:r.properties||r})),g.success("Search complete",`Found ${c.value.length} similar nodes`)}else m.value=t.error||"Search failed"}catch(t){m.value=t.message||"Search failed"}finally{x.value=!1}}function I(l){v.value=l}function R(l){J.push({path:"/graph",query:{nodeId:String(l.id)}})}async function D(){if(c.value.length===0)return;const l=JSON.stringify(c.value,null,2);try{const t=await N.saveFile({title:"Export Search Results",defaultPath:"knn-results.json",filters:[{name:"JSON Files",extensions:["json"]}]});t&&(await N.writeFile(t,l),g.success("Export complete",`Results saved to ${t}`))}catch(t){g.error("Export failed",t.message)}}return T(()=>{A()}),(l,t)=>(o(),n("div",H,[t[29]||(t[29]=e("div",{class:"mb-6"},[e("h1",{class:"text-2xl font-bold text-text-primary"},"Vector Search (KNN)"),e("p",{class:"text-text-secondary mt-1"},"Search for similar nodes using vector embeddings")],-1)),e("div",Q,[e("div",W,[t[12]||(t[12]=e("h3",{class:"text-sm font-medium text-text-secondary mb-3"},"Embedding Vector",-1)),e("div",X,[e("div",Y,[y(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>d.value=s),class:"px-3 py-2 bg-bg-tertiary border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"},[...t[7]||(t[7]=[e("option",{value:"text"},"Text Input",-1),e("option",{value:"json"},"JSON Array",-1),e("option",{value:"file"},"Load from File",-1)])],512),[[O,d.value]]),e("span",Z,a(d.value==="text"?"Enter comma-separated values":d.value==="json"?"Enter JSON array":"Load embedding from file"),1)]),d.value==="text"?y((o(),n("textarea",{key:0,"onUpdate:modelValue":t[1]||(t[1]=s=>h.value=s),rows:"4",class:"w-full p-3 bg-bg-tertiary border border-border rounded-lg font-mono text-sm focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"0.1, 0.2, 0.3, -0.4, 0.5..."},null,512)),[[V,h.value]]):u("",!0),d.value==="json"?y((o(),n("textarea",{key:1,"onUpdate:modelValue":t[2]||(t[2]=s=>f.value=s),rows:"4",class:"w-full p-3 bg-bg-tertiary border border-border rounded-lg font-mono text-sm focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"[0.1, 0.2, 0.3, -0.4, 0.5]"},null,512)),[[V,f.value]]):u("",!0),d.value==="file"?(o(),n("div",ee,[e("button",{onClick:P,class:"btn btn-secondary"},[...t[8]||(t[8]=[e("i",{class:"fas fa-file-upload mr-2"},null,-1),b(" Load Embedding File ",-1)])]),F.value?(o(),n("p",te,[t[9]||(t[9]=e("i",{class:"fas fa-file mr-1"},null,-1)),b(" "+a(F.value),1)])):u("",!0)])):u("",!0),p.value.length>0?(o(),n("div",se,[t[10]||(t[10]=e("i",{class:"fas fa-check-circle text-success mr-1"},null,-1)),b(" Vector dimensions: "+a(p.value.length),1)])):u("",!0),S.value?(o(),n("div",le,[t[11]||(t[11]=e("i",{class:"fas fa-exclamation-circle mr-1"},null,-1)),b(" "+a(S.value),1)])):u("",!0)])]),e("div",ne,[t[16]||(t[16]=e("h3",{class:"text-sm font-medium text-text-secondary mb-3"},"Search Options",-1)),e("div",oe,[e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm text-text-secondary mb-1"},"Number of Results (K)",-1)),y(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>E.value=s),type:"number",min:"1",max:"100",class:"w-full px-3 py-2 bg-bg-tertiary border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[V,E.value,void 0,{number:!0}]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm text-text-secondary mb-1"},"Filter by Label (Optional)",-1)),y(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>j.value=s),class:"w-full px-3 py-2 bg-bg-tertiary border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"},[t[14]||(t[14]=e("option",{value:""},"All Labels",-1)),(o(!0),n(w,null,_(L.value,s=>(o(),n("option",{key:s,value:s},a(s),9,ae))),128))],512),[[O,j.value]])]),e("button",{onClick:$,class:"w-full btn btn-primary",disabled:x.value||p.value.length===0},[e("i",{class:q(["fas mr-2",x.value?"fa-spinner fa-spin":"fa-search"])},null,2),b(" "+a(x.value?"Searching...":"Search Similar Nodes"),1)],8,re)])])]),e("div",ie,[m.value?(o(),n("div",de,[t[17]||(t[17]=e("div",{class:"flex items-center gap-2 text-error"},[e("i",{class:"fas fa-exclamation-circle"}),e("span",{class:"font-medium"},"Search Error")],-1)),e("p",ue,a(m.value),1)])):u("",!0),c.value.length>0?(o(),n("div",ce,[e("div",me,[e("div",ve,[t[18]||(t[18]=e("h3",{class:"font-semibold"},"Search Results",-1)),e("span",fe,a(c.value.length)+" similar nodes found",1)]),e("button",{onClick:D,class:"btn btn-secondary text-xs"},[...t[19]||(t[19]=[e("i",{class:"fas fa-download mr-1"},null,-1),b(" Export ",-1)])])]),e("div",xe,[e("table",pe,[t[21]||(t[21]=e("thead",null,[e("tr",null,[e("th",null,"Rank"),e("th",null,"Node ID"),e("th",null,"Labels"),e("th",null,"Similarity"),e("th",null,"Properties"),e("th",null,"Actions")])],-1)),e("tbody",null,[(o(!0),n(w,null,_(c.value,(s,r)=>(o(),n("tr",{key:s.id},[e("td",be,a(r+1),1),e("td",ge,a(s.id),1),e("td",null,[(o(!0),n(w,null,_(s.labels,k=>(o(),n("span",{key:k,class:"inline-block px-2 py-0.5 bg-accent/20 text-accent rounded text-xs mr-1"},a(k),1))),128))]),e("td",null,[e("div",ye,[e("div",he,[e("div",{class:"h-full bg-accent rounded-full",style:G({width:`${s.similarity*100}%`})},null,4)]),e("span",Se,a((s.similarity*100).toFixed(1))+"%",1)])]),e("td",null,[e("button",{onClick:k=>I(s),class:"text-accent hover:underline text-sm"}," View Properties ",8,ke)]),e("td",null,[e("button",{onClick:k=>R(s),class:"text-text-muted hover:text-accent text-sm",title:"View in Graph"},[...t[20]||(t[20]=[e("i",{class:"fas fa-project-diagram"},null,-1)])],8,we)])]))),128))])])])])):u("",!0),!c.value.length&&!m.value&&!x.value?(o(),n("div",_e,[...t[22]||(t[22]=[e("div",{class:"text-center text-text-muted"},[e("i",{class:"fas fa-vector-square text-4xl mb-4"}),e("p",{class:"text-lg mb-2"},"Vector Similarity Search"),e("p",{class:"text-sm"},"Enter an embedding vector to find similar nodes in the graph")],-1)])])):u("",!0)]),v.value?(o(),n("div",Ne,[e("div",Fe,[e("div",Ee,[t[24]||(t[24]=e("h3",{class:"text-lg font-semibold"},"Node Properties",-1)),e("button",{onClick:t[5]||(t[5]=s=>v.value=null),class:"text-text-muted hover:text-text-primary"},[...t[23]||(t[23]=[e("i",{class:"fas fa-times"},null,-1)])])]),e("div",je,[e("div",null,[t[25]||(t[25]=e("span",{class:"text-sm text-text-secondary"},"ID:",-1)),e("span",Ve,a(v.value.id),1)]),e("div",null,[t[26]||(t[26]=e("span",{class:"text-sm text-text-secondary"},"Labels:",-1)),(o(!0),n(w,null,_(v.value.labels,s=>(o(),n("span",{key:s,class:"ml-2 px-2 py-0.5 bg-accent/20 text-accent rounded text-sm"},a(s),1))),128))]),e("div",null,[t[27]||(t[27]=e("span",{class:"text-sm text-text-secondary"},"Similarity:",-1)),e("span",Ce,a((v.value.similarity*100).toFixed(2))+"%",1)]),e("div",null,[t[28]||(t[28]=e("span",{class:"text-sm text-text-secondary block mb-2"},"Properties:",-1)),e("pre",Le,a(JSON.stringify(v.value.properties,null,2)),1)])]),e("div",Oe,[e("button",{onClick:t[6]||(t[6]=s=>v.value=null),class:"btn btn-secondary"},"Close")])])])):u("",!0)]))}});export{Pe as default};
