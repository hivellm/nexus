import{C as H,r as s,c as w}from"./index-CGTMR5kG.js";import{u as C}from"./servers-Dx8MWeGI.js";const d="nexus-desktop-query-history",v=100,E=H("query",()=>{const a=s("MATCH (n) RETURN n LIMIT 25"),l=s(null),c=s(!1),u=s(null),t=s([]);function p(){try{const e=localStorage.getItem(d);if(e){const n=JSON.parse(e);t.value=n.map(o=>({...o,timestamp:new Date(o.timestamp)}))}}catch(e){console.error("Failed to load query history:",e)}}function i(){try{localStorage.setItem(d,JSON.stringify(t.value.slice(0,v)))}catch(e){console.error("Failed to save query history:",e)}}p();const S=w(()=>t.value.slice(0,10));async function h(e){var f,m;const o=C().activeClient;if(!o)return u.value="No server connected",null;const y=e||a.value;if(!y.trim())return u.value="Query cannot be empty",null;c.value=!0,u.value=null;try{const r=await o.executeCypher(y),q={id:`query-${Date.now()}`,query:y,timestamp:new Date,executionTime:((f=r.data)==null?void 0:f.executionTime)||0,rowCount:((m=r.data)==null?void 0:m.rowCount)||0,success:r.success,error:r.error};return t.value.unshift(q),t.value.length>v&&(t.value=t.value.slice(0,v)),i(),r.success&&r.data?(l.value=r.data,r.data):(u.value=r.error||"Query execution failed",null)}catch(r){return u.value=r.message||"Query execution failed",null}finally{c.value=!1}}function x(e){a.value=e}function Q(){l.value=null,u.value=null}function T(){t.value=[],i()}function g(e){t.value=t.value.filter(n=>n.id!==e),i()}return{currentQuery:a,lastResult:l,isExecuting:c,error:u,history:t,recentQueries:S,executeQuery:h,setQuery:x,clearResult:Q,clearHistory:T,removeFromHistory:g}});export{E as u};
