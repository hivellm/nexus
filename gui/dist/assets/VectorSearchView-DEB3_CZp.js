import{d as D,u as B,m as T,r as c,e as q,f as G,c as r,a as e,b as v,w as k,y as O,t as i,v as V,k as S,F as E,j as A,n as K,i as W,l as H,o as a}from"./index-CP6pyHN1.js";const m=()=>typeof window<"u"&&window.electronAPI!==void 0,P={minimizeWindow:()=>{m()&&window.electronAPI.windowControl("minimize")},toggleMaximize:()=>{m()&&window.electronAPI.windowControl("maximize")},closeWindow:()=>{m()&&window.electronAPI.windowControl("close")},isMaximized:async()=>m()?window.electronAPI.isMaximized():!1,getVersion:async()=>m()?window.electronAPI.getAppVersion():"0.1.0-dev",getPlatform:()=>m()?window.electronAPI.platform:"web",openFile:async n=>m()?window.electronAPI.showOpenDialog(n):new Promise(y=>{const f=document.createElement("input");f.type="file",n!=null&&n.filters&&(f.accept=n.filters.flatMap(d=>d.extensions.map(o=>`.${o}`)).join(",")),f.onchange=()=>{var o;const d=(o=f.files)==null?void 0:o[0];y(d?d.name:null)},f.click()}),saveFile:async n=>m()?window.electronAPI.showSaveDialog(n):prompt("Enter filename:",(n==null?void 0:n.defaultPath)||"export.json"),readFile:async n=>{if(m())return window.electronAPI.readFile(n);throw new Error("File reading not supported in browser mode")},writeFile:async(n,y)=>{if(m())return window.electronAPI.writeFile(n,y);const f=new Blob([y],{type:"text/plain"}),d=URL.createObjectURL(f),o=document.createElement("a");o.href=d,o.download=n.split("/").pop()||"file.txt",o.click(),URL.revokeObjectURL(d)},showNotification:n=>{"Notification"in window&&Notification.permission==="granted"&&new Notification(n.title,{body:n.body})},openExternal:async n=>{if(m())return window.electronAPI.openExternal(n);window.open(n,"_blank")}},Q={class:"h-full flex flex-col p-6"},X={class:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6"},Y={class:"lg:col-span-2 card p-4"},Z={class:"space-y-3"},ee={class:"flex items-center gap-2"},te={class:"text-xs text-text-muted"},se={key:2,class:"space-y-2"},le={key:0,class:"text-sm text-text-muted"},ne={key:3,class:"text-xs text-text-muted"},oe={key:4,class:"text-xs text-error"},re={class:"card p-4"},ae={class:"space-y-4"},ie=["value"],de=["disabled"],ue={class:"flex-1 overflow-hidden"},ce={key:0,class:"mb-4 p-4 bg-error/10 border border-error/20 rounded-lg"},me={class:"mt-1 text-sm text-text-secondary"},fe={key:1,class:"card h-full flex flex-col"},ve={class:"p-4 border-b border-border flex items-center justify-between"},xe={class:"flex items-center gap-4"},pe={class:"text-sm text-text-muted"},be={class:"flex-1 overflow-auto p-4"},ye={class:"table"},ge={class:"text-center font-mono"},we={class:"font-mono text-sm"},he={class:"flex items-center gap-2"},Se={class:"w-20 h-2 bg-bg-tertiary rounded-full overflow-hidden"},ke={class:"text-sm font-mono"},Ne=["onClick"],_e=["onClick"],Fe={key:2,class:"h-full flex items-center justify-center"},Ee={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},Ae={class:"bg-bg-secondary rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[80vh] overflow-auto"},Pe={class:"flex items-center justify-between mb-4"},je={class:"space-y-4"},Ie={class:"ml-2 font-mono"},Le={class:"ml-2"},Ve={class:"p-4 bg-bg-tertiary rounded-lg font-mono text-sm overflow-auto max-h-64"},Ce={class:"flex justify-end mt-6"},Je=D({__name:"VectorSearchView",setup(n){const y=H(),f=B(),d=T(),o=c("text"),N=c(""),g=c(""),j=c(""),I=c(10),L=c(""),C=c([]),w=c(!1),p=c(null),x=c([]),b=c(null),_=c(null),h=q(()=>{_.value=null;try{if(o.value==="text"&&N.value.trim())return N.value.split(",").map(t=>{const s=parseFloat(t.trim());if(isNaN(s))throw new Error(`Invalid number: ${t}`);return s});if(o.value==="json"&&g.value.trim()){const l=JSON.parse(g.value);if(!Array.isArray(l))throw new Error("Must be a JSON array");if(!l.every(t=>typeof t=="number"))throw new Error("All elements must be numbers");return l}return[]}catch(l){return _.value=l.message,[]}});async function J(){const l=f.activeClient;if(l)try{const t=await l.getLabels();t.success&&t.data&&(C.value=t.data.map(s=>s.name||s.label||String(s)))}catch(t){console.error("Failed to load labels:",t)}}async function R(){try{const l=await P.openFile({title:"Load Embedding File",filters:[{name:"JSON Files",extensions:["json"]},{name:"All Files",extensions:["*"]}]});if(l){const t=await P.readFile(l),s=JSON.parse(t);if(Array.isArray(s))g.value=JSON.stringify(s),o.value="json";else if(s.embedding&&Array.isArray(s.embedding))g.value=JSON.stringify(s.embedding),o.value="json";else throw new Error('File must contain a JSON array or object with "embedding" field');j.value=l.split(/[\\/]/).pop()||l,d.success("File loaded",`Loaded ${h.value.length} dimensions`)}}catch(l){d.error("Load failed",l.message)}}async function $(){const l=f.activeClient;if(!l){p.value="No server connected";return}if(h.value.length===0){p.value="Please enter a valid embedding vector";return}w.value=!0,p.value=null,x.value=[];try{const t=await l.knnSearch(h.value,I.value,L.value||void 0);if(t.success&&t.data){const s=t.data.rows||t.data||[];x.value=s.map(u=>({id:u.id||u._nexus_id||u.nodeId,labels:u.labels||u._nexus_labels||[],similarity:u.similarity||u.score||u.distance||0,properties:u.properties||u})),d.success("Search complete",`Found ${x.value.length} similar nodes`)}else p.value=t.error||"Search failed"}catch(t){p.value=t.message||"Search failed"}finally{w.value=!1}}function z(l){b.value=l}function M(l){y.push({path:"/graph",query:{nodeId:String(l.id)}})}async function U(){if(x.value.length===0)return;const l=JSON.stringify(x.value,null,2);try{const t=await P.saveFile({title:"Export Search Results",defaultPath:"knn-results.json",filters:[{name:"JSON Files",extensions:["json"]}]});t&&(await P.writeFile(t,l),d.success("Export complete",`Results saved to ${t}`))}catch(t){d.error("Export failed",t.message)}}return G(()=>{J()}),(l,t)=>(a(),r("div",Q,[t[29]||(t[29]=e("div",{class:"mb-6"},[e("h1",{class:"text-2xl font-bold text-text-primary"},"Vector Search (KNN)"),e("p",{class:"text-text-secondary mt-1"},"Search for similar nodes using vector embeddings")],-1)),e("div",X,[e("div",Y,[t[12]||(t[12]=e("h3",{class:"text-sm font-medium text-text-secondary mb-3"},"Embedding Vector",-1)),e("div",Z,[e("div",ee,[k(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>o.value=s),class:"px-3 py-2 bg-bg-tertiary border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"},[...t[7]||(t[7]=[e("option",{value:"text"},"Text Input",-1),e("option",{value:"json"},"JSON Array",-1),e("option",{value:"file"},"Load from File",-1)])],512),[[O,o.value]]),e("span",te,i(o.value==="text"?"Enter comma-separated values":o.value==="json"?"Enter JSON array":"Load embedding from file"),1)]),o.value==="text"?k((a(),r("textarea",{key:0,"onUpdate:modelValue":t[1]||(t[1]=s=>N.value=s),rows:"4",class:"w-full p-3 bg-bg-tertiary border border-border rounded-lg font-mono text-sm focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"0.1, 0.2, 0.3, -0.4, 0.5..."},null,512)),[[V,N.value]]):v("",!0),o.value==="json"?k((a(),r("textarea",{key:1,"onUpdate:modelValue":t[2]||(t[2]=s=>g.value=s),rows:"4",class:"w-full p-3 bg-bg-tertiary border border-border rounded-lg font-mono text-sm focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"[0.1, 0.2, 0.3, -0.4, 0.5]"},null,512)),[[V,g.value]]):v("",!0),o.value==="file"?(a(),r("div",se,[e("button",{onClick:R,class:"btn btn-secondary"},[...t[8]||(t[8]=[e("i",{class:"fas fa-file-upload mr-2"},null,-1),S(" Load Embedding File ",-1)])]),j.value?(a(),r("p",le,[t[9]||(t[9]=e("i",{class:"fas fa-file mr-1"},null,-1)),S(" "+i(j.value),1)])):v("",!0)])):v("",!0),h.value.length>0?(a(),r("div",ne,[t[10]||(t[10]=e("i",{class:"fas fa-check-circle text-success mr-1"},null,-1)),S(" Vector dimensions: "+i(h.value.length),1)])):v("",!0),_.value?(a(),r("div",oe,[t[11]||(t[11]=e("i",{class:"fas fa-exclamation-circle mr-1"},null,-1)),S(" "+i(_.value),1)])):v("",!0)])]),e("div",re,[t[16]||(t[16]=e("h3",{class:"text-sm font-medium text-text-secondary mb-3"},"Search Options",-1)),e("div",ae,[e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm text-text-secondary mb-1"},"Number of Results (K)",-1)),k(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>I.value=s),type:"number",min:"1",max:"100",class:"w-full px-3 py-2 bg-bg-tertiary border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"},null,512),[[V,I.value,void 0,{number:!0}]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm text-text-secondary mb-1"},"Filter by Label (Optional)",-1)),k(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>L.value=s),class:"w-full px-3 py-2 bg-bg-tertiary border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"},[t[14]||(t[14]=e("option",{value:""},"All Labels",-1)),(a(!0),r(E,null,A(C.value,s=>(a(),r("option",{key:s,value:s},i(s),9,ie))),128))],512),[[O,L.value]])]),e("button",{onClick:$,class:"w-full btn btn-primary",disabled:w.value||h.value.length===0},[e("i",{class:K(["fas mr-2",w.value?"fa-spinner fa-spin":"fa-search"])},null,2),S(" "+i(w.value?"Searching...":"Search Similar Nodes"),1)],8,de)])])]),e("div",ue,[p.value?(a(),r("div",ce,[t[17]||(t[17]=e("div",{class:"flex items-center gap-2 text-error"},[e("i",{class:"fas fa-exclamation-circle"}),e("span",{class:"font-medium"},"Search Error")],-1)),e("p",me,i(p.value),1)])):v("",!0),x.value.length>0?(a(),r("div",fe,[e("div",ve,[e("div",xe,[t[18]||(t[18]=e("h3",{class:"font-semibold"},"Search Results",-1)),e("span",pe,i(x.value.length)+" similar nodes found",1)]),e("button",{onClick:U,class:"btn btn-secondary text-xs"},[...t[19]||(t[19]=[e("i",{class:"fas fa-download mr-1"},null,-1),S(" Export ",-1)])])]),e("div",be,[e("table",ye,[t[21]||(t[21]=e("thead",null,[e("tr",null,[e("th",null,"Rank"),e("th",null,"Node ID"),e("th",null,"Labels"),e("th",null,"Similarity"),e("th",null,"Properties"),e("th",null,"Actions")])],-1)),e("tbody",null,[(a(!0),r(E,null,A(x.value,(s,u)=>(a(),r("tr",{key:s.id},[e("td",ge,i(u+1),1),e("td",we,i(s.id),1),e("td",null,[(a(!0),r(E,null,A(s.labels,F=>(a(),r("span",{key:F,class:"inline-block px-2 py-0.5 bg-accent/20 text-accent rounded text-xs mr-1"},i(F),1))),128))]),e("td",null,[e("div",he,[e("div",Se,[e("div",{class:"h-full bg-accent rounded-full",style:W({width:`${s.similarity*100}%`})},null,4)]),e("span",ke,i((s.similarity*100).toFixed(1))+"%",1)])]),e("td",null,[e("button",{onClick:F=>z(s),class:"text-accent hover:underline text-sm"}," View Properties ",8,Ne)]),e("td",null,[e("button",{onClick:F=>M(s),class:"text-text-muted hover:text-accent text-sm",title:"View in Graph"},[...t[20]||(t[20]=[e("i",{class:"fas fa-project-diagram"},null,-1)])],8,_e)])]))),128))])])])])):v("",!0),!x.value.length&&!p.value&&!w.value?(a(),r("div",Fe,[...t[22]||(t[22]=[e("div",{class:"text-center text-text-muted"},[e("i",{class:"fas fa-vector-square text-4xl mb-4"}),e("p",{class:"text-lg mb-2"},"Vector Similarity Search"),e("p",{class:"text-sm"},"Enter an embedding vector to find similar nodes in the graph")],-1)])])):v("",!0)]),b.value?(a(),r("div",Ee,[e("div",Ae,[e("div",Pe,[t[24]||(t[24]=e("h3",{class:"text-lg font-semibold"},"Node Properties",-1)),e("button",{onClick:t[5]||(t[5]=s=>b.value=null),class:"text-text-muted hover:text-text-primary"},[...t[23]||(t[23]=[e("i",{class:"fas fa-times"},null,-1)])])]),e("div",je,[e("div",null,[t[25]||(t[25]=e("span",{class:"text-sm text-text-secondary"},"ID:",-1)),e("span",Ie,i(b.value.id),1)]),e("div",null,[t[26]||(t[26]=e("span",{class:"text-sm text-text-secondary"},"Labels:",-1)),(a(!0),r(E,null,A(b.value.labels,s=>(a(),r("span",{key:s,class:"ml-2 px-2 py-0.5 bg-accent/20 text-accent rounded text-sm"},i(s),1))),128))]),e("div",null,[t[27]||(t[27]=e("span",{class:"text-sm text-text-secondary"},"Similarity:",-1)),e("span",Le,i((b.value.similarity*100).toFixed(2))+"%",1)]),e("div",null,[t[28]||(t[28]=e("span",{class:"text-sm text-text-secondary block mb-2"},"Properties:",-1)),e("pre",Ve,i(JSON.stringify(b.value.properties,null,2)),1)])]),e("div",Ce,[e("button",{onClick:t[6]||(t[6]=s=>b.value=null),class:"btn btn-secondary"},"Close")])])])):v("",!0)]))}});export{Je as default};
