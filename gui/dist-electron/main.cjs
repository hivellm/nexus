"use strict";const i=require("electron"),t=require("node:path"),s=require("node:fs/promises");process.env.DIST=t.join(__dirname,"../dist");process.env.VITE_PUBLIC=i.app.isPackaged?process.env.DIST:t.join(process.env.DIST,"../public");let n=null;const d=t.join(__dirname,"preload.cjs"),r=process.env.VITE_DEV_SERVER_URL;function c(){n=new i.BrowserWindow({width:1400,height:900,minWidth:1e3,minHeight:700,icon:t.join(process.env.VITE_PUBLIC||"","icon.png"),frame:!1,transparent:!1,backgroundColor:"#0f172a",webPreferences:{preload:d,nodeIntegration:!1,contextIsolation:!0,sandbox:!1},...process.platform==="darwin"&&{titleBarStyle:"hiddenInset",trafficLightPosition:{x:10,y:10}}}),n.webContents.on("did-finish-load",()=>{n==null||n.webContents.send("main-process-message",new Date().toLocaleString())}),r?(n.loadURL(r),n.webContents.openDevTools()):n.loadFile(t.join(process.env.DIST,"index.html"))}i.app.on("window-all-closed",()=>{process.platform!=="darwin"&&(i.app.quit(),n=null)});i.app.on("activate",()=>{i.BrowserWindow.getAllWindows().length===0&&c()});i.app.whenReady().then(c);i.ipcMain.handle("app:getVersion",()=>i.app.getVersion());i.ipcMain.handle("app:getPlatform",()=>process.platform);i.ipcMain.handle("dialog:openFile",async(l,e)=>{if(!n)return null;const a=await i.dialog.showOpenDialog(n,{title:(e==null?void 0:e.title)||"Open File",filters:(e==null?void 0:e.filters)||[{name:"Cypher Files",extensions:["cypher","cql"]},{name:"JSON Files",extensions:["json"]},{name:"All Files",extensions:["*"]}],defaultPath:e==null?void 0:e.defaultPath,properties:["openFile"]});return a.canceled||a.filePaths.length===0?null:a.filePaths[0]});i.ipcMain.handle("dialog:saveFile",async(l,e)=>{if(!n)return null;const a=await i.dialog.showSaveDialog(n,{title:(e==null?void 0:e.title)||"Save File",filters:(e==null?void 0:e.filters)||[{name:"JSON Files",extensions:["json"]},{name:"CSV Files",extensions:["csv"]},{name:"All Files",extensions:["*"]}],defaultPath:e==null?void 0:e.defaultPath});return a.canceled||!a.filePath?null:a.filePath});i.ipcMain.handle("fs:readFile",async(l,e)=>{try{return await s.readFile(e,"utf-8")}catch(a){throw new Error(`Failed to read file: ${a.message}`)}});i.ipcMain.handle("fs:writeFile",async(l,e,a)=>{try{await s.writeFile(e,a,"utf-8")}catch(o){throw new Error(`Failed to write file: ${o.message}`)}});i.ipcMain.on("window:minimize",()=>{n&&n.minimize()});i.ipcMain.on("window:maximize",()=>{n&&(n.isMaximized()?n.unmaximize():n.maximize())});i.ipcMain.on("window:close",()=>{n&&n.close()});i.ipcMain.handle("window:isMaximized",()=>(n==null?void 0:n.isMaximized())||!1);i.ipcMain.on("notification:show",(l,e)=>{i.Notification.isSupported()&&new i.Notification({title:e.title,body:e.body}).show()});i.ipcMain.handle("shell:openExternal",async(l,e)=>{await i.shell.openExternal(e)});
