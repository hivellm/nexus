# Docker Compose for running tests in different environments
# Usage: docker-compose -f scripts/docker/docker-compose.test.yml up ubuntu-test

version: "3.8"

services:
  # Ubuntu test environment (similar to GitHub Actions ubuntu-latest)
  ubuntu-test:
    build:
      context: ../..
      dockerfile: scripts/docker/Dockerfile.test-ubuntu
    volumes:
      - ../..:/workspace
    working_dir: /workspace
    command: cargo nextest run --workspace --no-default-features

  # Ubuntu test with specific filter
  ubuntu-test-filtered:
    build:
      context: ../..
      dockerfile: scripts/docker/Dockerfile.test-ubuntu
    volumes:
      - ../..:/workspace
    working_dir: /workspace
    command: cargo nextest run --workspace --no-default-features -E 'test(integration)'

  # Ubuntu shell for debugging
  ubuntu-shell:
    build:
      context: ../..
      dockerfile: scripts/docker/Dockerfile.test-ubuntu
    volumes:
      - ../..:/workspace
    working_dir: /workspace
    stdin_open: true
    tty: true
    command: bash
