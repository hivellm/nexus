openapi: 3.0.3
info:
  title: Nexus Graph Database API
  description: |
    High-performance graph database with native vector similarity search capabilities.
    
    ## Features
    - Graph database with Cypher query support
    - KNN vector similarity search
    - REST API with comprehensive endpoints
    - MCP (Model Context Protocol) with StreamableHTTP transport
    - Bulk data ingestion
    - Schema management
    
    ## Authentication
    Authentication is supported via:
    - **API Keys**: Long-lived credentials for programmatic access (`X-API-Key` header or `Authorization: Bearer nx_...`)
    - **JWT Tokens**: Short-lived tokens for user sessions (`Authorization: Bearer <token>`)
    
    Most endpoints require authentication unless explicitly marked as public. See security requirements on each endpoint.
    
    ## Rate Limiting
    Rate limiting is implemented per-IP with token bucket algorithm (100 req/min default).
    
    ## Error Handling
    All endpoints return appropriate HTTP status codes and error messages in JSON format.
  version: 0.5.0
  contact:
    name: Nexus Development Team
    url: https://github.com/your-org/nexus
    email: support@nexus-db.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:3000
    description: Development server
  - url: https://api.nexus-db.com
    description: Production server

paths:
  /health:
    get:
      summary: Health Check
      description: Returns server health status and version information
      operationId: healthCheck
      tags:
        - System
      responses:
        '200':
          description: Server is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "ok"
                  version:
                    type: string
                    example: "0.4.0"
                  timestamp:
                    type: string
                    format: date-time
                  uptime:
                    type: number
                    description: Server uptime in seconds
                  protocol:
                    type: string
                    example: "nexus/1.0"

  /cypher:
    post:
      summary: Execute Cypher Query
      description: |
        Execute a Cypher query against the graph database.
        
        **Authentication Required**: Yes (READ permission for read queries, WRITE permission for write queries)
        
        ## Supported Cypher Features
        
        ### Read Operations
        - MATCH patterns with nodes and relationships
        - WHERE clauses with property filtering
        - RETURN clauses with expressions
        - LIMIT and ORDER BY
        - Aggregation functions (COUNT, AVG, MAX, MIN, SUM, COLLECT)
        - Variable length paths with `*` syntax (e.g., `[*1..3]`, `[*5]`, `[*1..]`)
        - Vector similarity search with `<->` operator
        - Procedure calls with `CALL` syntax (e.g., `CALL db.labels() YIELD label RETURN label`)
        - Geospatial Point types with serialization to JSON (x, y, z, crs fields)
        - Spatial indexes with `CREATE SPATIAL INDEX ON :Label(property)` syntax
        - Distance functions: `distance(point1, point2)` for calculating distances between points
        - Geospatial procedures: `spatial.withinBBox()` and `spatial.withinDistance()` for spatial queries
        - Function management: `CREATE FUNCTION`, `DROP FUNCTION`, `SHOW FUNCTIONS` for managing UDF signatures
        
        ### Write Operations
        - CREATE nodes and relationships
        - MERGE with ON CREATE and ON MATCH clauses
        - SET properties and labels
        - REMOVE properties and labels
        - DELETE nodes (with relationship validation)
        - DETACH DELETE nodes (removes relationships automatically)
        
        ## Examples
        ```cypher
        // Find all nodes
        MATCH (n) RETURN n LIMIT 10
        
        // Find nodes with conditions
        MATCH (n:Person) WHERE n.age > 25 RETURN n.name, n.age
        
        // Vector similarity search
        MATCH (n:Person) WHERE n.vector IS NOT NULL 
        RETURN n.name ORDER BY n.vector <-> [0.1, 0.2, 0.3] LIMIT 5
        
        // MERGE with ON CREATE
        MERGE (n:Person {email: 'alice@example.com'}) 
        ON CREATE SET n.created = true 
        RETURN n
        
        // SET properties and labels
        MATCH (n:Person {email: 'alice@example.com'}) 
        SET n.age = 31, n.city = 'NYC', n:Employee 
        RETURN n
        
        // REMOVE properties and labels
        MATCH (n:Person {email: 'alice@example.com'}) 
        REMOVE n.age, n:Employee 
        RETURN n
        
        // DELETE node (fails if relationships exist)
        MATCH (n:Person {email: 'alice@example.com'}) 
        DELETE n
        
        // DETACH DELETE (removes relationships first)
        MATCH (n:Person) 
        DETACH DELETE n
        ```
      operationId: executeCypher
      tags:
        - Queries
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CypherRequest'
            examples:
              simple_query:
                summary: Simple query
                value:
                  query: "MATCH (n:Person) RETURN n.name, n.age LIMIT 10"
                  params: {}
              parameterized_query:
                summary: Query with parameters
                value:
                  query: "MATCH (n:Person) WHERE n.age > $min_age RETURN n.name, n.age"
                  params:
                    min_age: 25
              vector_query:
                summary: Vector similarity query
                value:
                  query: "MATCH (n:Person) WHERE n.vector IS NOT NULL RETURN n.name ORDER BY n.vector <-> $vector LIMIT 5"
                  params:
                    vector: [0.1, 0.2, 0.3, 0.4]
              merge_query:
                summary: MERGE with ON CREATE
                value:
                  query: "MERGE (n:Person {email: 'alice@example.com'}) ON CREATE SET n.created = true RETURN n"
                  params: {}
              set_query:
                summary: SET properties and labels
                value:
                  query: "MATCH (n:Person {email: 'alice@example.com'}) SET n.age = 31, n.city = 'NYC', n:Employee RETURN n"
                  params: {}
              remove_query:
                summary: REMOVE properties and labels
                value:
                  query: "MATCH (n:Person {email: 'alice@example.com'}) REMOVE n.age, n:Employee RETURN n"
              procedure_call:
                summary: Procedure call with CALL
                value:
                  query: "CALL db.labels() YIELD label RETURN label"
                  params: {}
              point_serialization:
                summary: Geospatial Point serialization
                value:
                  query: "RETURN point({x: 1, y: 2, crs: 'cartesian'}) AS p"
                  params: {}
              variable_length_path:
                summary: Variable length path query
                value:
                  query: "MATCH (a:Person {name: 'Alice'})-[*1..3]->(b) RETURN a, b LIMIT 10"
                  params: {}
              create_without_return:
                summary: CREATE without RETURN (returns created nodes automatically)
                value:
                  query: "CREATE (n:Person {name: 'Alice', age: 30})"
                  params: {}
              delete_with_count:
                summary: DELETE with RETURN count
                value:
                  query: "MATCH (n:Person) DELETE n RETURN count(*) AS deleted"
                  params: {}
              create_spatial_index:
                summary: CREATE SPATIAL INDEX
                value:
                  query: "CREATE SPATIAL INDEX ON :Location(coords)"
                  params: {}
              geospatial_distance:
                summary: Geospatial distance calculation
                value:
                  query: "MATCH (l:Location) RETURN l.name, distance(l.coords, point({x: -122.4194, y: 37.7749, crs: 'wgs-84'})) AS dist ORDER BY dist LIMIT 5"
                  params: {}
              geospatial_procedure:
                summary: Geospatial procedure - withinDistance
                value:
                  query: "CALL spatial.withinDistance('Location', 'coords', point({x: -122.4194, y: 37.7749, crs: 'wgs-84'}), 1000.0) YIELD node RETURN node"
                  params: {}
              show_functions:
                summary: SHOW FUNCTIONS - List all registered functions
                value:
                  query: "SHOW FUNCTIONS"
                  params: {}
              create_function:
                summary: CREATE FUNCTION - Create function signature
                value:
                  query: "CREATE FUNCTION multiply(a: Integer, b: Integer) RETURNS Integer AS 'Multiply two integers'"
                  params: {}
              create_function_if_not_exists:
                summary: CREATE FUNCTION IF NOT EXISTS
                value:
                  query: "CREATE FUNCTION IF NOT EXISTS add(a: Integer, b: Integer) RETURNS Integer"
                  params: {}
              drop_function:
                summary: DROP FUNCTION - Remove function signature
                value:
                  query: "DROP FUNCTION multiply"
                  params: {}
              drop_function_if_exists:
                summary: DROP FUNCTION IF EXISTS
                value:
                  query: "DROP FUNCTION IF EXISTS multiply"
                  params: {}
              delete_query:
                summary: DELETE node
                value:
                  query: "MATCH (n:Person {email: 'alice@example.com'}) DELETE n"
                  params: {}
              detach_delete_query:
                summary: DETACH DELETE nodes
                value:
                  query: "MATCH (n:Person) DETACH DELETE n"
                  params: {}
      responses:
        '200':
          description: Query executed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CypherResponse'
        '400':
          description: Invalid query syntax or parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - Invalid or missing authentication
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error:
                  code: "INVALID_TOKEN"
                  message: "Invalid or expired API key"
        '403':
          description: Forbidden - Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error:
                  code: "FORBIDDEN"
                  message: "Insufficient permissions: WRITE required"
        '408':
          description: Query timeout
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          description: Too Many Requests - Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error:
                  code: "RATE_LIMIT_EXCEEDED"
                  message: "Rate limit exceeded. Try again later."
          headers:
            X-RateLimit-Limit:
              schema:
                type: integer
              description: Rate limit per window
            X-RateLimit-Remaining:
              schema:
                type: integer
              description: Remaining requests in current window
            X-RateLimit-Reset:
              schema:
                type: integer
              description: Unix timestamp when rate limit resets
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /knn_traverse:
    post:
      summary: KNN Traversal
      description: |
        Perform k-nearest neighbor traversal starting from a vector query.
        
        This endpoint combines vector similarity search with graph traversal,
        allowing you to find similar entities and then traverse their relationships.
      operationId: knnTraverse
      tags:
        - Vector Search
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/KnnTraverseRequest'
            examples:
              basic_knn:
                summary: Basic KNN search
                value:
                  label: "Person"
                  vector: [0.1, 0.2, 0.3, 0.4]
                  k: 10
              knn_with_filter:
                summary: KNN with additional filters
                value:
                  label: "Person"
                  vector: [0.1, 0.2, 0.3, 0.4]
                  k: 5
                  where: "n.age > 25"
                  limit: 50
      responses:
        '200':
          description: KNN traversal completed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/KnnTraverseResponse'
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /ingest:
    post:
      summary: Bulk Data Ingestion
      description: |
        Ingest large amounts of nodes and relationships in a single operation.
        
        This endpoint is optimized for bulk data loading and provides
        throughput metrics for performance monitoring.
      operationId: ingestData
      tags:
        - Data Management
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IngestRequest'
            examples:
              bulk_nodes:
                summary: Bulk node ingestion
                value:
                  nodes:
                    - labels: ["Person"]
                      properties:
                        name: "Alice"
                        age: 30
                    - labels: ["Person"]
                      properties:
                        name: "Bob"
                        age: 28
                  relationships: []
              bulk_relationships:
                summary: Bulk relationship ingestion
                value:
                  nodes: []
                  relationships:
                    - src: 1
                      dst: 2
                      type: "KNOWS"
                      properties:
                        since: "2020"
      responses:
        '200':
          description: Data ingested successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IngestResponse'
        '400':
          description: Invalid data format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /schema/labels:
    get:
      summary: List Labels
      description: List all node labels in the database
      operationId: listLabels
      tags:
        - Schema
      responses:
        '200':
          description: Labels retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LabelListResponse'
    post:
      summary: Create Label
      description: Create a new node label
      operationId: createLabel
      tags:
        - Schema
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateLabelRequest'
      responses:
        '200':
          description: Label created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateLabelResponse'
        '400':
          description: Invalid label name
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /schema/rel_types:
    get:
      summary: List Relationship Types
      description: List all relationship types in the database
      operationId: listRelTypes
      tags:
        - Schema
      responses:
        '200':
          description: Relationship types retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelTypeListResponse'
    post:
      summary: Create Relationship Type
      description: Create a new relationship type
      operationId: createRelType
      tags:
        - Schema
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRelTypeRequest'
      responses:
        '200':
          description: Relationship type created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateRelTypeResponse'
        '400':
          description: Invalid relationship type name
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /data/nodes:
    post:
      summary: Create Node
      description: Create a single node with labels and properties
      operationId: createNode
      tags:
        - Data Management
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateNodeRequest'
      responses:
        '200':
          description: Node created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateNodeResponse'
    put:
      summary: Update Node
      description: Update properties of an existing node
      operationId: updateNode
      tags:
        - Data Management
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateNodeRequest'
      responses:
        '200':
          description: Node updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpdateNodeResponse'
    delete:
      summary: Delete Node
      description: Delete a node and all its relationships
      operationId: deleteNode
      tags:
        - Data Management
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteNodeRequest'
      responses:
        '200':
          description: Node deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteNodeResponse'

  /data/relationships:
    post:
      summary: Create Relationship
      description: Create a single relationship between two nodes
      operationId: createRel
      tags:
        - Data Management
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRelRequest'
      responses:
        '200':
          description: Relationship created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateRelResponse'

  /stats:
    get:
      summary: Database Statistics
      description: Get comprehensive database statistics including node counts, relationship counts, and index information
      operationId: getStats
      tags:
        - System
      responses:
        '200':
          description: Statistics retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatsResponse'

  /databases:
    get:
      summary: List Databases
      description: Get a list of all databases in the server instance
      operationId: listDatabases
      tags:
        - Databases
      responses:
        '200':
          description: List of databases
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListDatabasesResponse'
    post:
      summary: Create Database
      description: Create a new database with the specified name
      operationId: createDatabase
      tags:
        - Databases
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDatabaseRequest'
      responses:
        '200':
          description: Database created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateDatabaseResponse'
        '400':
          description: Invalid database name or database already exists

  /databases/{name}:
    get:
      summary: Get Database Info
      description: Get information about a specific database
      operationId: getDatabase
      tags:
        - Databases
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
          description: Database name
      responses:
        '200':
          description: Database information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseInfo'
        '404':
          description: Database not found
    delete:
      summary: Drop Database
      description: Permanently delete a database and all its data
      operationId: dropDatabase
      tags:
        - Databases
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
          description: Database name
      responses:
        '200':
          description: Database dropped successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DropDatabaseResponse'
        '400':
          description: Cannot drop default database or currently active database
        '404':
          description: Database not found

  /session/database:
    get:
      summary: Get Current Session Database
      description: Get the name of the currently active database for this session
      operationId: getCurrentDatabase
      tags:
        - Databases
      responses:
        '200':
          description: Current database name
          content:
            application/json:
              schema:
                type: object
                properties:
                  database:
                    type: string
                    description: Current database name
                    example: neo4j
    put:
      summary: Switch Session Database
      description: Switch the current session to a different database
      operationId: switchDatabase
      tags:
        - Databases
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SwitchDatabaseRequest'
      responses:
        '200':
          description: Database switched successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SwitchDatabaseResponse'
        '404':
          description: Database not found

  # Replication Endpoints
  /replication/status:
    get:
      summary: Get Replication Status
      description: Get the current replication status including role, connection state, and offset
      operationId: getReplicationStatus
      tags:
        - Replication
      responses:
        '200':
          description: Replication status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReplicationStatusResponse'

  /replication/master/stats:
    get:
      summary: Get Master Statistics
      description: Get replication statistics for the master node
      operationId: getMasterStats
      tags:
        - Replication
      responses:
        '200':
          description: Master statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MasterStatsResponse'
        '404':
          description: Master not running

  /replication/replica/stats:
    get:
      summary: Get Replica Statistics
      description: Get replication statistics for the replica node
      operationId: getReplicaStats
      tags:
        - Replication
      responses:
        '200':
          description: Replica statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReplicaStatsResponse'
        '404':
          description: Replica not running

  /replication/replicas:
    get:
      summary: List Connected Replicas
      description: Get list of all replicas connected to this master
      operationId: listReplicas
      tags:
        - Replication
      responses:
        '200':
          description: List of connected replicas
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListReplicasResponse'
        '404':
          description: Master not running

  /replication/promote:
    post:
      summary: Promote Replica to Master
      description: Promote this replica node to become a master
      operationId: promoteReplica
      tags:
        - Replication
      responses:
        '200':
          description: Replica promoted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReplicationResponse'
        '404':
          description: Replica not running
        '500':
          description: Promotion failed

  /replication/snapshot:
    get:
      summary: Get Last Snapshot Info
      description: Get information about the last created snapshot
      operationId: getSnapshot
      tags:
        - Replication
      responses:
        '200':
          description: Snapshot information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SnapshotResponse'
        '404':
          description: No snapshot available
    post:
      summary: Create Snapshot
      description: Create a new snapshot of the database for replication
      operationId: createSnapshot
      tags:
        - Replication
      responses:
        '200':
          description: Snapshot created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SnapshotResponse'
        '500':
          description: Snapshot creation failed

  /replication/stop:
    post:
      summary: Stop Replication
      description: Stop the current replication process (master or replica)
      operationId: stopReplication
      tags:
        - Replication
      responses:
        '200':
          description: Replication stopped
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReplicationResponse'

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: API key for programmatic access (format: nx_...)
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token or API key (format: nx_...) for authentication
  schemas:
    CypherRequest:
      type: object
      required:
        - query
      properties:
        query:
          type: string
          description: Cypher query to execute
          example: "MATCH (n:Person) RETURN n.name, n.age LIMIT 10"
        params:
          type: object
          description: Query parameters
          additionalProperties: true
          example:
            min_age: 25
            name: "Alice"
        timeout_ms:
          type: integer
          description: Query timeout in milliseconds
          default: 5000
          minimum: 100
          maximum: 60000

    CypherResponse:
      type: object
      properties:
        results:
          type: array
          description: Query results
          items:
            type: object
            additionalProperties: true
        execution_time_ms:
          type: integer
          description: Query execution time in milliseconds
        error:
          type: string
          description: Error message if query failed

    KnnTraverseRequest:
      type: object
      required:
        - label
        - vector
        - k
      properties:
        label:
          type: string
          description: Node label to search
          example: "Person"
        vector:
          type: array
          items:
            type: number
          description: Query vector for similarity search
          example: [0.1, 0.2, 0.3, 0.4]
        k:
          type: integer
          description: Number of nearest neighbors to find
          minimum: 1
          maximum: 1000
          example: 10
        where:
          type: string
          description: Additional WHERE clause for filtering
          example: "n.age > 25"
        limit:
          type: integer
          description: Maximum number of results to return
          minimum: 1
          maximum: 10000
          default: 100

    KnnTraverseResponse:
      type: object
      properties:
        results:
          type: array
          description: KNN traversal results
          items:
            type: object
            properties:
              node:
                type: object
                description: Node data
                additionalProperties: true
              similarity:
                type: number
                description: Similarity score
                minimum: 0
                maximum: 1
        execution_time_ms:
          type: integer
          description: Execution time in milliseconds
        error:
          type: string
          description: Error message if operation failed

    IngestRequest:
      type: object
      properties:
        nodes:
          type: array
          description: Nodes to ingest
          items:
            $ref: '#/components/schemas/NodeIngest'
        relationships:
          type: array
          description: Relationships to ingest
          items:
            $ref: '#/components/schemas/RelIngest'

    NodeIngest:
      type: object
      properties:
        id:
          type: integer
          description: Node ID (optional, auto-generated if not provided)
        labels:
          type: array
          items:
            type: string
          description: Node labels
          example: ["Person", "Developer"]
        properties:
          type: object
          description: Node properties
          additionalProperties: true
          example:
            name: "Alice"
            age: 30
            email: "alice@example.com"

    RelIngest:
      type: object
      required:
        - src
        - dst
        - type
      properties:
        id:
          type: integer
          description: Relationship ID (optional, auto-generated if not provided)
        src:
          type: integer
          description: Source node ID
        dst:
          type: integer
          description: Destination node ID
        type:
          type: string
          description: Relationship type
          example: "KNOWS"
        properties:
          type: object
          description: Relationship properties
          additionalProperties: true
          example:
            since: "2020"
            strength: 0.8

    IngestResponse:
      type: object
      properties:
        nodes_ingested:
          type: integer
          description: Number of nodes successfully ingested
        relationships_ingested:
          type: integer
          description: Number of relationships successfully ingested
        execution_time_ms:
          type: integer
          description: Ingestion execution time in milliseconds
        errors:
          type: array
          items:
            type: string
          description: List of errors encountered during ingestion

    CreateLabelRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          description: Label name
          example: "Person"
          minLength: 1
          maxLength: 255

    CreateLabelResponse:
      type: object
      properties:
        label_id:
          type: integer
          description: Created label ID
        error:
          type: string
          description: Error message if creation failed

    LabelListResponse:
      type: object
      properties:
        labels:
          type: array
          items:
            type: object
            properties:
              id:
                type: integer
              name:
                type: string
        error:
          type: string
          description: Error message if operation failed

    CreateRelTypeRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          description: Relationship type name
          example: "KNOWS"
          minLength: 1
          maxLength: 255

    CreateRelTypeResponse:
      type: object
      properties:
        type_id:
          type: integer
          description: Created relationship type ID
        error:
          type: string
          description: Error message if creation failed

    RelTypeListResponse:
      type: object
      properties:
        types:
          type: array
          items:
            type: object
            properties:
              id:
                type: integer
              name:
                type: string
        error:
          type: string
          description: Error message if operation failed

    CreateNodeRequest:
      type: object
      required:
        - labels
      properties:
        labels:
          type: array
          items:
            type: string
          description: Node labels
          example: ["Person", "Developer"]
        properties:
          type: object
          description: Node properties
          additionalProperties: true
          example:
            name: "Alice"
            age: 30

    CreateNodeResponse:
      type: object
      properties:
        node_id:
          type: integer
          description: Created node ID
        error:
          type: string
          description: Error message if creation failed

    UpdateNodeRequest:
      type: object
      required:
        - id
        - properties
      properties:
        id:
          type: integer
          description: Node ID to update
        properties:
          type: object
          description: Updated properties
          additionalProperties: true

    UpdateNodeResponse:
      type: object
      properties:
        success:
          type: boolean
          description: Whether update was successful
        error:
          type: string
          description: Error message if update failed

    DeleteNodeRequest:
      type: object
      required:
        - id
      properties:
        id:
          type: integer
          description: Node ID to delete

    DeleteNodeResponse:
      type: object
      properties:
        success:
          type: boolean
          description: Whether deletion was successful
        error:
          type: string
          description: Error message if deletion failed

    CreateRelRequest:
      type: object
      required:
        - src
        - dst
        - type
      properties:
        src:
          type: integer
          description: Source node ID
        dst:
          type: integer
          description: Destination node ID
        type:
          type: string
          description: Relationship type
        properties:
          type: object
          description: Relationship properties
          additionalProperties: true

    CreateRelResponse:
      type: object
      properties:
        rel_id:
          type: integer
          description: Created relationship ID
        error:
          type: string
          description: Error message if creation failed

    StatsResponse:
      type: object
      properties:
        catalog:
          type: object
          properties:
            total_labels:
              type: integer
              description: Total number of node labels
            total_types:
              type: integer
              description: Total number of relationship types
            total_keys:
              type: integer
              description: Total number of property keys
        label_index:
          type: object
          properties:
            indexed_labels:
              type: integer
              description: Number of indexed labels
            total_nodes:
              type: integer
              description: Total number of nodes
        knn_index:
          type: object
          properties:
            total_vectors:
              type: integer
              description: Total number of vectors
            dimension:
              type: integer
              description: Vector dimension
        error:
          type: string
          description: Error message if operation failed

    # Database Management Schemas
    DatabaseInfo:
      type: object
      properties:
        name:
          type: string
          description: Database name
          example: neo4j
        path:
          type: string
          description: Database storage path
          example: data/neo4j
        created_at:
          type: integer
          description: Creation timestamp (Unix epoch)
          example: 1700000000
        node_count:
          type: integer
          description: Number of nodes in the database
          example: 1000
        relationship_count:
          type: integer
          description: Number of relationships in the database
          example: 5000
        storage_size:
          type: integer
          description: Storage size in bytes
          example: 1048576

    ListDatabasesResponse:
      type: object
      properties:
        databases:
          type: array
          description: List of databases
          items:
            $ref: '#/components/schemas/DatabaseInfo'
        default_database:
          type: string
          description: Name of the default database
          example: neo4j

    CreateDatabaseRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          description: Database name (alphanumeric, underscores, hyphens)
          example: mydb
          pattern: "^[a-zA-Z0-9_-]+$"

    CreateDatabaseResponse:
      type: object
      properties:
        success:
          type: boolean
          description: Whether the operation was successful
          example: true
        name:
          type: string
          description: Name of the created database
          example: mydb
        message:
          type: string
          description: Status message
          example: "Database 'mydb' created successfully"

    DropDatabaseResponse:
      type: object
      properties:
        success:
          type: boolean
          description: Whether the operation was successful
          example: true
        message:
          type: string
          description: Status message
          example: "Database 'mydb' dropped successfully"

    SwitchDatabaseRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          description: Database name to switch to
          example: mydb

    SwitchDatabaseResponse:
      type: object
      properties:
        success:
          type: boolean
          description: Whether the operation was successful
          example: true
        message:
          type: string
          description: Status message
          example: "Switched to database 'mydb'"

    ErrorResponse:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
              description: Error code (e.g., INVALID_TOKEN, FORBIDDEN, RATE_LIMIT_EXCEEDED)
              example: "INVALID_TOKEN"
            message:
              type: string
              description: Human-readable error message
              example: "Invalid or expired API key"
            details:
              type: object
              description: Additional error details
              additionalProperties: true

    # Replication Schemas
    ReplicationStatusResponse:
      type: object
      properties:
        role:
          type: string
          enum: [master, replica, standalone]
          description: Current replication role
          example: "master"
        running:
          type: boolean
          description: Whether replication is currently running
          example: true
        mode:
          type: string
          enum: [async, sync]
          description: Replication mode
          example: "async"
        connected:
          type: boolean
          description: Whether connected (replica to master, or master has replicas)
          example: true
        node_id:
          type: string
          description: Unique identifier for this node
          example: "550e8400-e29b-41d4-a716-446655440000"
        wal_offset:
          type: integer
          format: int64
          description: Current WAL offset
          example: 12345
        lag:
          type: integer
          format: int64
          description: Replication lag in operations (replica only)
          example: 5
        replica_count:
          type: integer
          description: Number of connected replicas (master only)
          example: 2

    MasterStatsResponse:
      type: object
      properties:
        entries_replicated:
          type: integer
          format: int64
          description: Total WAL entries replicated
          example: 100000
        bytes_sent:
          type: integer
          format: int64
          description: Total bytes sent to replicas
          example: 52428800
        connected_replicas:
          type: integer
          description: Number of currently connected replicas
          example: 2
        healthy_replicas:
          type: integer
          description: Number of healthy replicas
          example: 2
        log_size:
          type: integer
          description: Current replication log size
          example: 50000
        current_offset:
          type: integer
          format: int64
          description: Current WAL offset
          example: 100000
        sync_acks:
          type: integer
          format: int64
          description: Number of sync acknowledgments received
          example: 95000
        snapshot_transfers:
          type: integer
          format: int64
          description: Number of snapshot transfers completed
          example: 1

    ReplicaStatsResponse:
      type: object
      properties:
        entries_received:
          type: integer
          format: int64
          description: Total WAL entries received
          example: 99500
        entries_applied:
          type: integer
          format: int64
          description: Total WAL entries applied
          example: 99500
        bytes_received:
          type: integer
          format: int64
          description: Total bytes received from master
          example: 51380224
        current_offset:
          type: integer
          format: int64
          description: Current WAL offset
          example: 99500
        lag:
          type: integer
          format: int64
          description: Replication lag in operations
          example: 500
        reconnects:
          type: integer
          description: Number of reconnection attempts
          example: 0
        connected:
          type: boolean
          description: Whether connected to master
          example: true
        master_id:
          type: string
          description: Connected master's ID
          example: "550e8400-e29b-41d4-a716-446655440001"

    ReplicaInfoResponse:
      type: object
      properties:
        id:
          type: string
          description: Replica ID
          example: "550e8400-e29b-41d4-a716-446655440002"
        addr:
          type: string
          description: Replica address
          example: "192.168.1.10:15475"
        last_ack_offset:
          type: integer
          format: int64
          description: Last acknowledged WAL offset
          example: 99000
        lag:
          type: integer
          format: int64
          description: Replication lag
          example: 1000
        healthy:
          type: boolean
          description: Whether replica is healthy
          example: true
        connected_seconds:
          type: integer
          format: int64
          description: Connection duration in seconds
          example: 3600

    ListReplicasResponse:
      type: object
      properties:
        replicas:
          type: array
          items:
            $ref: '#/components/schemas/ReplicaInfoResponse'
          description: List of connected replicas

    SnapshotResponse:
      type: object
      properties:
        id:
          type: string
          description: Snapshot ID
          example: "550e8400-e29b-41d4-a716-446655440003"
        created_at:
          type: integer
          format: int64
          description: Creation timestamp (Unix milliseconds)
          example: 1732900000000
        wal_offset:
          type: integer
          format: int64
          description: WAL offset at snapshot time
          example: 100000
        uncompressed_size:
          type: integer
          format: int64
          description: Uncompressed size in bytes
          example: 104857600
        compressed_size:
          type: integer
          format: int64
          description: Compressed size in bytes
          example: 31457280
        files_count:
          type: integer
          description: Number of files in snapshot
          example: 5

    ReplicationResponse:
      type: object
      properties:
        success:
          type: boolean
          description: Whether the operation was successful
          example: true
        message:
          type: string
          description: Status message
          example: "Replication stopped"

tags:
  - name: System
    description: System health and statistics endpoints
  - name: Queries
    description: Cypher query execution
  - name: Vector Search
    description: KNN vector similarity search
  - name: Data Management
    description: Node and relationship management
  - name: Schema
    description: Schema management (labels and relationship types)
  - name: Databases
    description: Multi-database management (create, drop, switch, list databases)
  - name: Replication
    description: Master-replica replication management (status, stats, snapshots, failover)